# 小结

本小结用于汇总本项目中在课堂演示时需要展示的关键点、实现思路与使用示例，便于讲解与后续扩展。

代码架构（概览）

1. 主循环对话系统：基于 bubbletea 实现的事件/消息驱动 CLI UI，用于管理用户输入、系统输出及状态机转移。

2. GoAgent：统一的 agent 管理层，负责注册并调度可调用函数（工具），以及注入对应的系统提示词与上下文。

3. 子 agent（sub-agent）：在执行复杂或可拆分任务时，主 agent 会创建子 agent 完成更小的子任务（并行或串行），使逻辑模块化。

4. 并行工具调用：建议在允许的场景下一次性开启多个并行工具调用，减少 round-trip，提升效率并降低 token 消耗（适用于独立且无依赖的子任务）。

实现细节与建议

- 调用函数时尽量设计幂等接口，并在请求/响应中包含 task_id 以便追踪与重试。
- 对长任务使用子 agent 拆分为若干步骤（prepare -> execute -> finalize），每步可独立重试。
- 系统提示词建议集中管理，按模块命名并记录版本号，以便 A/B 调优与回滚。

系统提示词（示例）

- assistant_system: "你是一个擅长将用户需求拆解为可执行任务的助理，优先使用已注册工具完成任务。"

注册函数（示例）

- tools.FetchURL(url) -> 返回网页文本
- tools.RunShell(cmd) -> 返回命令输出（限制沙箱与超时）
- tools.SearchDB(query) -> 返回查询结果摘要

课程展示要点

- 通过流程图展示主 agent 与子 agent 的交互流程。
- 演示一次并行工具调用对比串行调用的性能/token 差异。
- 展示如何通过修改系统提示词改变 agent 行为（示例前后对比）。

待补充

- 具体代码示例与关键文件位置（将在课程准备阶段补充具体引用）。

